<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Blog]]></title>
  <link href="http://blog.chacrue.com/atom.xml" rel="self"/>
  <link href="http://blog.chacrue.com/"/>
  <updated>2014-01-14T15:29:24+09:00</updated>
  <id>http://blog.chacrue.com/</id>
  <author>
    <name><![CDATA[R Asaka]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[VagrantでNFSマウント出来ない]]></title>
    <link href="http://blog.chacrue.com/nfs-mount-error/"/>
    <updated>2014-01-13T19:01:58+09:00</updated>
    <id>http://blog.chacrue.com/nfs-mount-error</id>
    <content type="html"><![CDATA[<p>ホストとの共有は <a href="http://mitchellh.com/comparing-filesystem-performance-in-virtual-machines">NFSの方がパフォーマンスが良い</a> らしいので、<br/>
Vagrantfileで設定してみたところ、エラーが発生してNFSマウント出来ない。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ vim Vagrantfile
</span><span class='line'>config.vm.synced_folder "/Users/xxx/app/", "/app/", nfs: true</span></code></pre></td></tr></table></div></figure>


<p>下記エラーが発生。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ vagrant up
</span><span class='line'>[default] Exporting NFS shared folders...
</span><span class='line'>NFS is reporting that your exports file is invalid. Vagrant does
</span><span class='line'>this check before making any changes to the file. Please correct
</span><span class='line'>the issues below and execute "vagrant reload":
</span><span class='line'>
</span><span class='line'>Can't open /etc/exports</span></code></pre></td></tr></table></div></figure>


<p>ホスト側で/etc/exportsを作成（空ファイルでよい）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ sudo touch /etc/exports</span></code></pre></td></tr></table></div></figure>


<p>NFSは起動していた。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ sudo nfsd status
</span><span class='line'>nfsd service is enabled
</span><span class='line'>nfsd is running (pid 3697, 8 threads)</span></code></pre></td></tr></table></div></figure>


<p>起動していなかった場合は以下を実行。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ sudo nfsd enable</span></code></pre></td></tr></table></div></figure>


<p>別エラー発生。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ vagrant reload
</span><span class='line'>[default] Exporting NFS shared folders...
</span><span class='line'>Preparing to edit /etc/exports. Administrator privileges will be required...
</span><span class='line'>[default] Mounting NFS shared folders...
</span><span class='line'>The following SSH command responded with a non-zero exit status.
</span><span class='line'>Vagrant assumes that this means the command failed!
</span><span class='line'>
</span><span class='line'>mount -o 'vers=3,udp' 192.168.33.1:'/Users/xxx/app' /app
</span><span class='line'>
</span><span class='line'>Stdout from the command:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Stderr from the command:
</span><span class='line'>
</span><span class='line'>mount.nfs: access denied by server while mounting 192.168.33.1:/Users/xxx/app</span></code></pre></td></tr></table></div></figure>


<p>sudo nfsd checkexports→vagrant reloadで解決</p>

<p><a href="https://github.com/mitchellh/vagrant/issues/1744">https://github.com/mitchellh/vagrant/issues/1744</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ sudo nfsd checkexports
</span><span class='line'>Mac$ vagrant reload
</span><span class='line'>[default] Exporting NFS shared folders...
</span><span class='line'>Preparing to edit /etc/exports. Administrator privileges will be required...
</span><span class='line'>[default] Mounting NFS shared folders...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant$ df -h /app
</span><span class='line'>Filesystem                     Size  Used Avail Use% Mounted on
</span><span class='line'>192.168.33.1:/Users/xxx/app  466G   48G  417G  11% /app</span></code></pre></td></tr></table></div></figure>


<h3>バージョン</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac$ vagrant --version
</span><span class='line'>Vagrant 1.4.1
</span><span class='line'>Mac$ sw_vers
</span><span class='line'>ProductName:  Mac OS X
</span><span class='line'>ProductVersion: 10.9.1
</span><span class='line'>BuildVersion: 13B3116
</span><span class='line'>
</span><span class='line'>vagrant$ cat /etc/redhat-release
</span><span class='line'>CentOS release 6.5 (Final)</span></code></pre></td></tr></table></div></figure>


<h3>VagrantのBox</h3>

<p><a href="https://github.com/2creatives/vagrant-centos/releases/download/v6.5.1/centos65-x86_64-20131205.box">https://github.com/2creatives/vagrant-centos/releases/download/v6.5.1/centos65-x86_64-20131205.box</a></p>
]]></content>
  </entry>
  
</feed>
